# Построитель каскада Хаара

Субмодуль компьютероного зрения, который обучает каскад Хаара и позволяет использовать его для распознавания объектов в видеопотоке.

## Создание каскада

Работа модуля разделяется на два этапа: создание каскада и его использование. В данном разделе описываются методы запуска процедуры создания каскада Хаара.

#### Получение негативных изображений

Получить изображения можно с помощью разбиения видеоряда на кадры. Для этого используется скрипт `frames_generator.py`. 


Также допускается использование изображений со сторонних ресурсов. Их загрузку осуществляет метод `frames_extractor`. 

Далее полученные изображения масштабируются (по необходимости) с помощью метода `resize`.

Для дальнейшей работы необходимо создать текстовый файл с путями к полученным изображениям (генерируется с помощью консольной утилиты `find`).

#### Получение позитивных изображений

Существует 2 способа получения позитивных изображений: встраивание одного позитивного примитива во все негативные изображения с помощью утилиты `opencv_createsamples`:
```
opencv_createsamples -img rsz_cup.jpg -bg bg.txt -info info/info2.lst info -maxxangle 0.5 -maxyangle 0.5 -maxzangle 0.5 -num 600
``` 
Также допускается ручной сбор позитивных примеров и дальнейшее формирование файла, содержащего список позитивов, их количества на кадре и координаты их расположения на изображении:
```
./neg/739.jpg 1 1 6 4 7
./neg/142.jpg 1 23 54 234 445
./neg/446.jpg 1 76 45 657 333 
```

#### Создание вектора позитивных изображений

Для создания вектора позитивных изображений используется утилита `opencv_createsamples`:
```
opencv_createsamples -info info/info2.lst -num 600 -w 20 -h 20 -vec positives.vec
```

#### Обучение каскада

Для обучение каскада Хаара используется утилита `opencv_traincascade`:

```
opencv_traincascade -data data -vec positives.vec -bg bg.txt -numPos 550 -numNeg 300 -numStages 20 -w 20 -h 20
```

## Использование полученного каскада

Каскад, созданный на предыдущем этапе, используется для обнаружения позитивных объектов в видеопотоке. Его обработка осуществляется с помощью скрипта `main.py`:
```
 objects = cup_cascade.detectMultiScale(gray, 1.3, 25)
```
Первый параметр - изображение, второй - шаг масштабирования, третий - количество соседних элементов изображений, содержащих один и тот же примитив.
В `objects` хранятся координаты найденных объектов.


